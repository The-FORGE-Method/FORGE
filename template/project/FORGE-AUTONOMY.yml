# FORGE Autonomy Policy
# Schema version: 0.2
# Documentation: method/templates/forge-template-autonomy-policy.md
# Introduced: v1.3.0 (Decision-005)
# Updated: v2.0 (Template Simplification)

version: 0.2
template_version: "2.0"
external_project: true

# Autonomy tier determines routing behavior
# Tier 0: @G refuses transitions, instructs human (default)
# Tier 1: @G asks human approval before dispatching
# Tier 2: Auto-dispatch with guardrails (Phase 2)
# Tier 3: Full autonomous pipeline (Phase 2)
tier: 0

# Progressive lifecycle gates (v2.0 enforcement model)
# Gates enforce readiness at each FORGE phase
# All gates are human-bypassable with explicit instruction
lifecycle_gates:
  gate_1_prd:
    agent: F
    artifact: "docs/constitution/PRODUCT.md"
    required_sections: ["description", "actors", "use_cases", "mvp", "success_criteria"]
  gate_2_architecture:
    agent: O
    artifact: "docs/constitution/TECH.md"
    requires: gate_1_prd
    required_sections: ["stack", "data_model", "build_plan"]
  gate_3_coherence:
    agent: R
    requires: gate_2_architecture
  gate_4_execution:
    agent: [G, E]
    requires: gate_3_coherence
    packet_path: "_forge/inbox/active/"

# Router behavior constraints
router:
  # All transitions must route through @G (no direct role-to-role)
  allow_direct_role_to_role: false
  # Transition events logged via git commit history (v2.0)
  event_log_path: "git"

# Allowed transitions when @G is permitted to route (Tier 1+)
# Tier 0 ignores this and refuses all transitions
allowed_transitions:
  - from: F
    to: O
  - from: O
    to: R
  - from: R
    to: G
  - from: G
    to: E

# Actions that always require human approval regardless of tier
human_gates:
  - constitution_change
  - scope_change
  - architecture_change
  - production_deploy
  - billing_or_payments
  - secrets_or_credentials
  - data_migration_destructive

# Blast radius thresholds for automatic routing (Tier 2/3 only)
# Tier 0/1 ignores these (no auto-dispatch)
blast_radius:
  max_files_changed_auto: 20
  max_loc_changed_auto: 800
  forbid_paths:
    - "docs/constitution/**"
    - "infra/prod/**"

# Notifications
notifications:
  on_checkpoint: true
  on_exception: true
  on_autoroute: false  # Not applicable in Tier 0/1
